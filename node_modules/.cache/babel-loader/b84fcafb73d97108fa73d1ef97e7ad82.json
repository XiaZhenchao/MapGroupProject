{"ast":null,"code":"var ext = require('./extent'),\n  types = require('./types');\nmodule.exports.write = function writePoints(geometries, extent, shpView, shxView, TYPE) {\n  var shpI = 0,\n    shxI = 0,\n    shxOffset = 100;\n  geometries.forEach(writePolyLine);\n  function writePolyLine(coordinates, i) {\n    var flattened = justCoords(coordinates),\n      noParts = parts([coordinates], TYPE),\n      contentLength = flattened.length * 16 + 48 + (noParts - 1) * 4;\n    var featureExtent = flattened.reduce(function (extent, c) {\n      return ext.enlarge(extent, c);\n    }, ext.blank());\n\n    // INDEX\n    shxView.setInt32(shxI, shxOffset / 2); // offset\n    shxView.setInt32(shxI + 4, contentLength / 2); // offset length\n\n    shxI += 8;\n    shxOffset += contentLength + 8;\n    shpView.setInt32(shpI, i + 1); // record number\n    shpView.setInt32(shpI + 4, contentLength / 2); // length\n    shpView.setInt32(shpI + 8, TYPE, true); // POLYLINE=3\n    shpView.setFloat64(shpI + 12, featureExtent.xmin, true); // EXTENT\n    shpView.setFloat64(shpI + 20, featureExtent.ymin, true);\n    shpView.setFloat64(shpI + 28, featureExtent.xmax, true);\n    shpView.setFloat64(shpI + 36, featureExtent.ymax, true);\n    shpView.setInt32(shpI + 44, noParts, true);\n    shpView.setInt32(shpI + 48, flattened.length, true); // POINTS\n    shpView.setInt32(shpI + 52, 0, true); // The first part - index zero\n\n    var onlyParts = coordinates.reduce(function (arr, coords) {\n      if (Array.isArray(coords[0][0])) {\n        arr = arr.concat(coords);\n      } else {\n        arr.push(coords);\n      }\n      return arr;\n    }, []);\n    for (var p = 1; p < noParts; p++) {\n      shpView.setInt32(\n      // set part index\n      shpI + 52 + p * 4, onlyParts.reduce(function (a, b, idx) {\n        return idx < p ? a + b.length : a;\n      }, 0), true);\n    }\n    flattened.forEach(function writeLine(coords, i) {\n      shpView.setFloat64(shpI + 56 + i * 16 + (noParts - 1) * 4, coords[0], true); // X\n      shpView.setFloat64(shpI + 56 + i * 16 + (noParts - 1) * 4 + 8, coords[1], true); // Y\n    });\n\n    shpI += contentLength + 8;\n  }\n};\nmodule.exports.shpLength = function (geometries) {\n  return geometries.length * 56 +\n  // points\n  justCoords(geometries).length * 16;\n};\nmodule.exports.shxLength = function (geometries) {\n  return geometries.length * 8;\n};\nmodule.exports.extent = function (coordinates) {\n  return justCoords(coordinates).reduce(function (extent, c) {\n    return ext.enlarge(extent, c);\n  }, ext.blank());\n};\nfunction parts(geometries, TYPE) {\n  var no = 1;\n  if (TYPE === types.geometries.POLYGON || TYPE === types.geometries.POLYLINE) {\n    no = geometries.reduce(function (no, coords) {\n      no += coords.length;\n      if (Array.isArray(coords[0][0][0])) {\n        // multi\n        no += coords.reduce(function (no, rings) {\n          return no + rings.length - 1; // minus outer\n        }, 0);\n      }\n      return no;\n    }, 0);\n  }\n  return no;\n}\nmodule.exports.parts = parts;\nfunction totalPoints(geometries) {\n  var sum = 0;\n  geometries.forEach(function (g) {\n    sum += g.length;\n  });\n  return sum;\n}\nfunction justCoords(coords, l) {\n  if (l === undefined) l = [];\n  if (typeof coords[0][0] == 'object') {\n    return coords.reduce(function (memo, c) {\n      return memo.concat(justCoords(c));\n    }, l);\n  } else {\n    return coords;\n  }\n}","map":{"version":3,"names":["ext","require","types","module","exports","write","writePoints","geometries","extent","shpView","shxView","TYPE","shpI","shxI","shxOffset","forEach","writePolyLine","coordinates","i","flattened","justCoords","noParts","parts","contentLength","length","featureExtent","reduce","c","enlarge","blank","setInt32","setFloat64","xmin","ymin","xmax","ymax","onlyParts","arr","coords","Array","isArray","concat","push","p","a","b","idx","writeLine","shpLength","shxLength","no","POLYGON","POLYLINE","rings","totalPoints","sum","g","l","undefined","memo"],"sources":["/Users/yongerfan/Desktop/GroupProject/MapGroupProject/node_modules/shp-write/src/poly.js"],"sourcesContent":["var ext = require('./extent'),\n    types = require('./types');\n\nmodule.exports.write = function writePoints(geometries, extent, shpView, shxView, TYPE) {\n\n    var shpI = 0,\n        shxI = 0,\n        shxOffset = 100;\n\n    geometries.forEach(writePolyLine);\n\n    function writePolyLine(coordinates, i) {\n\n        var flattened = justCoords(coordinates),\n            noParts = parts([coordinates], TYPE),\n            contentLength = (flattened.length * 16) + 48 + (noParts - 1) * 4;\n\n        var featureExtent = flattened.reduce(function(extent, c) {\n            return ext.enlarge(extent, c);\n        }, ext.blank());\n\n        // INDEX\n        shxView.setInt32(shxI, shxOffset / 2); // offset\n        shxView.setInt32(shxI + 4, contentLength / 2); // offset length\n\n        shxI += 8;\n        shxOffset += contentLength + 8;\n\n        shpView.setInt32(shpI, i + 1); // record number\n        shpView.setInt32(shpI + 4, contentLength / 2); // length\n        shpView.setInt32(shpI + 8, TYPE, true); // POLYLINE=3\n        shpView.setFloat64(shpI + 12, featureExtent.xmin, true); // EXTENT\n        shpView.setFloat64(shpI + 20, featureExtent.ymin, true);\n        shpView.setFloat64(shpI + 28, featureExtent.xmax, true);\n        shpView.setFloat64(shpI + 36, featureExtent.ymax, true);\n        shpView.setInt32(shpI + 44, noParts, true);\n        shpView.setInt32(shpI + 48, flattened.length, true); // POINTS\n        shpView.setInt32(shpI + 52, 0, true); // The first part - index zero\n\n        var onlyParts = coordinates.reduce(function (arr, coords) {\n            if (Array.isArray(coords[0][0])) {\n                arr = arr.concat(coords);\n            } else {\n                arr.push(coords);\n            }\n            return arr;\n        }, []);\n        for (var p = 1; p < noParts; p++) {\n            shpView.setInt32( // set part index\n                shpI + 52 + (p * 4),\n                onlyParts.reduce(function (a, b, idx) {\n                    return idx < p ? a + b.length : a;\n                }, 0),\n                true\n            );\n        }\n\n        flattened.forEach(function writeLine(coords, i) {\n            shpView.setFloat64(shpI + 56 + (i * 16) + (noParts - 1) * 4, coords[0], true); // X\n            shpView.setFloat64(shpI + 56 + (i * 16) + (noParts - 1) * 4 + 8, coords[1], true); // Y\n        });\n\n        shpI += contentLength + 8;\n    }\n};\n\nmodule.exports.shpLength = function(geometries) {\n    return (geometries.length * 56) +\n        // points\n        (justCoords(geometries).length * 16);\n};\n\nmodule.exports.shxLength = function(geometries) {\n    return geometries.length * 8;\n};\n\nmodule.exports.extent = function(coordinates) {\n    return justCoords(coordinates).reduce(function(extent, c) {\n        return ext.enlarge(extent, c);\n    }, ext.blank());\n};\n\nfunction parts(geometries, TYPE) {\n    var no = 1;\n    if (TYPE === types.geometries.POLYGON || TYPE === types.geometries.POLYLINE)  {\n        no = geometries.reduce(function (no, coords) {\n            no += coords.length;\n            if (Array.isArray(coords[0][0][0])) { // multi\n                no += coords.reduce(function (no, rings) {\n                    return no + rings.length - 1; // minus outer\n                }, 0);\n            }\n            return no;\n        }, 0);\n    }\n    return no;\n}\n\nmodule.exports.parts = parts;\n\nfunction totalPoints(geometries) {\n    var sum = 0;\n    geometries.forEach(function(g) { sum += g.length; });\n    return sum;\n}\n\nfunction justCoords(coords, l) {\n    if (l === undefined) l = [];\n    if (typeof coords[0][0] == 'object') {\n        return coords.reduce(function(memo, c) {\n            return memo.concat(justCoords(c));\n        }, l);\n    } else {\n        return coords;\n    }\n}\n\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}